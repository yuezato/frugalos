FROM centos:7

ARG FRUGALOS_BRANCH
ARG RUST_VERSION

RUN yum -y install gcc automake libtool git make

RUN curl https://sh.rustup.rs -sSf > rustup.sh && sh rustup.sh -y
ENV PATH $PATH:/root/.cargo/bin

RUN rustup toolchain install $RUST_VERSION
RUN rustup default $RUST_VERSION

RUN git clone -b $FRUGALOS_BRANCH https://github.com/yuezato/frugalos
RUN cd frugalos && cargo build --release --all